<odoo>
    <template id="report_invoice_document" inherit_id="account.report_invoice_document">
        <xpath expr="." position="replace">
            <t t-call="web.html_container">
                <t t-foreach="docs" t-as="o">
                    <!-- Custom Header -->
                    <t t-call="report_e_invoice.report_e_invoice_header" t-lang="lang"/>

                    <t t-set="o" t-value="o.with_context(lang=lang)"/>
                    <div class="article" data-oe-model="account.move" t-att-data-oe-id="o.id">
                        <style>
                            @font-face {
                                font-family: 'DINNextLTArabic';
                                src: url('/report_e_invoice/static/src/fonts/DINNextLTArabic-Regular_0.ttf') format('truetype');
                                font-weight: normal;
                            }
                            body {
                                font-family: 'DINNextLTArabic', sans-serif;
                                font-size: 12px;
                                line-height: 1.6;
                                color: #333;
                                direction: rtl;
                            }
                            .invoice-title {
                                color: #1A5276;
                                font-size: 22px;
                                font-weight: bold;
                                text-align: center;
                                margin: 50px 0 25px 0;
                                padding-top: 30px;
                            }
                            .section-header {
                                background: #F8F9FA;
                                border: 1px solid #E5E7E9;
                                border-radius: 6px;
                                padding: 10px;
                                margin: 15px 0;
                                font-weight: bold;
                            }
                            .info-table {
                                width: 100%;
                                margin: 20px 0;
                                border-collapse: collapse;
                            }
                            .info-table td {
                                padding: 8px;
                                vertical-align: top;
                            }
                            .line-items-table {
                                width: 100%;
                                border-collapse: collapse;
                                margin: 20px 0;
                            }
                            .line-items-table th {
                                background: #1A5276;
                                color: white;
                                padding: 10px;
                                border: 1px solid #1A5276;
                                font-size: 11px;
                            }
                            .line-items-table td {
                                border: 1px solid #E5E7E9;
                                padding: 8px;
                                font-size: 11px;
                            }
                            .total-section {
                                float: left;
                                width: 35%;
                                margin-top: 20px;
                            }
                            .total-table {
                                width: 100%;
                                border-collapse: collapse;
                            }
                            .total-table td {
                                padding: 10px;
                                border: 1px solid #E5E7E9;
                            }
                            .total-row {
                                background: #1A5276;
                                color: white;
                                font-weight: bold;
                            }
                        </style>

                        <div class="page">
                            <h1 class="invoice-title">فاتورة ضريبية - Tax Invoice</h1>

                            <!-- Payment Status (Conditional) -->
                            <t t-if="report_name == 'account.report_invoice_with_payments'">
                                <div class="payment-status" style="margin-top: 20px; direction: rtl;">
                                    <div class="section-header">
                                        حالة الدفع - Payment Status
                                    </div>
                                    <table class="line-items-table">
                                        <thead>
                                            <tr>
                                                <th>تاريخ الدفع</th>
                                                <th>طريقة الدفع</th>
                                                <th>المبلغ المدفوع</th>
                                            </tr>
                                            <tr>
                                                <th>Payment Date</th>
                                                <th>Payment Method</th>
                                                <th>Amount Paid</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <t t-foreach="o.invoice_payments_widget.content" t-as="payment">
                                                <tr>
                                                    <td><span t-field="payment.date"/></td>
                                                    <td><span t-field="payment.payment_method_name"/></td>
                                                    <td><span t-field="payment.amount"/></td>
                                                </tr>
                                            </t>
                                        </tbody>
                                    </table>
                                </div>
                            </t>

                            <table class="info-table">
                                <tr>
                                    <td style="width: 30%;">
                                        <div style="margin-bottom: 10px;">
                                            <strong>تاريخ الاصدار</strong><br/>
                                            <span t-field="o.invoice_date"/>
                                        </div>
                                        <div>
                                            <strong>تاريخ التوريد</strong><br/>
                                            <t t-if="o.picking_delivery_date">
                                                <span t-field="o.picking_delivery_date"/>
                                            </t>
                                        </div>
                                    </td>
                                    <td style="width: 40%; text-align: center; font-size: 16px; font-weight: bold;">
                                        <span t-field="o.name"/>
                                    </td>
                                    <td style="width: 30%; text-align: left;">
                                        <strong>رقم الفاتورة</strong><br/>
                                        <span t-field="o.name"/>
                                    </td>
                                </tr>
                            </table>

                            <div style="display: flex; gap: 20px; margin-bottom: 20px;">
                                <div style="width: 50%;">
                                    <div class="section-header">من - From</div>
                                    <div style="padding: 10px;">
                                        <div style="font-weight: bold;"><span t-field="o.company_id.partner_id.name"/></div>
                                        <div><span t-field="o.company_id.partner_id.street"/></div>
                                        <div>الرقم الضريبي: <span t-field="o.company_id.partner_id.vat"/></div>
                                    </div>
                                </div>
                                <div style="width: 50%;">
                                    <div class="section-header">الى - To</div>
                                    <div style="padding: 10px;">
                                        <div style="font-weight: bold;"><span t-field="o.partner_id.name"/></div>
                                        <div><span t-field="o.partner_id.street"/></div>
                                        <div>الرقم الضريبي: <span t-field="o.partner_id.vat"/></div>
                                    </div>
                                </div>
                            </div>

                            <table class="line-items-table">
                                <thead>
                                    <tr>
                                        <th>الوصف</th>
                                        <th>السعر</th>
                                        <th>الكمية</th>
                                        <th>الخصم</th>
                                        <th>المبلغ قبل الضريبة</th>
                                        <th>نسبة الضريبة</th>
                                        <th>قيمة الضريبة</th>
                                        <th>الإجمالي</th>
                                    </tr>
                                    <tr>
                                        <th>Description</th>
                                        <th>Price</th>
                                        <th>Qty</th>
                                        <th>Discount</th>
                                        <th>Taxable</th>
                                        <th>VAT %</th>
                                        <th>VAT</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="o.invoice_line_ids" t-as="line">
                                        <tr>
                                            <td><span t-field="line.name"/></td>
                                            <td><span t-field="line.price_unit"/></td>
                                            <td><span t-field="line.quantity"/></td>
                                            <td><span t-field="line.discount"/>%</td>
                                            <td><span t-field="line.price_subtotal"/></td>
                                            <td><span t-esc="', '.join(map(lambda x: (x.description or x.name), line.tax_ids))"/></td>
                                            <td><span t-esc="line.price_total - line.price_subtotal"/></td>
                                            <td><span t-field="line.price_total"/></td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>

                            <div class="total-section">
                                <table class="total-table">
                                    <tr>
                                        <td>الإجمالي الفرعي</td>
                                        <td style="text-align: left;"><span t-field="o.amount_untaxed"/></td>
                                    </tr>
                                    <tr>
                                        <td>الضريبة</td>
                                        <td style="text-align: left;"><span t-field="o.amount_tax"/></td>
                                    </tr>
                                    <tr class="total-row">
                                        <td>المبلغ الإجمالي</td>
                                        <td style="text-align: left;"><strong><span t-field="o.amount_total"/></strong></td>
                                    </tr>
                                </table>
                            </div>
                            <div style="clear: both;"></div>
                        </div>
                    </div>
                    <!-- Custom Footer -->
                    <t t-call="report_e_invoice.report_e_invoice_footer" t-lang="lang"/>
                </t>
            </t>
        </xpath>
    </template>
</odoo>