<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <record forcecreate="True" id="budget_price" model="decimal.precision">
            <field name="name">Budget</field>
            <field name="digits" eval="3"/>
        </record>
    <record id="view_budget_operations_form" model="ir.ui.view">
        <field name="name">budget.operations.form</field>
        <field name="model">budget.operations</field>
        <field name="arch" type="xml">
            <form string="Budget Operations">
                <header>
                    <button string="Send" name="action_budget_manager" states="draft" type="object" class="oe_highlight"
                            groups="account_budget_custom.group_department_manager_budget,account_budget_custom.group_budget_user"/>

                    <button string="Approve" name="action_finance_ceo" states="budget_manager" type="object"
                            class="oe_highlight"
                            groups="account_budget_custom.group_department_manager_budget"/>
                    <button string="Reset to Draft" name="action_budget_draft" states="budget_manager" type="object"
                            groups="account_budget_custom.group_department_manager_budget"/>
                    <button string="Refuse" name="action_budget_refused" states="budget_manager" type="object"
                            groups="account_budget_custom.group_department_manager_budget"/>

                    <button string="Approve" name="action_vice_president" states="finance_ceo" type="object"
                            class="oe_highlight"
                            groups="odex25_account_saip.group_executive_director_finance"/>
                    <button string="Reset to Draft" name="action_budget_draft" states="finance_ceo" type="object"
                            groups="odex25_account_saip.group_executive_director_finance"/>
                    <button string="Refuse" name="action_budget_refused" states="finance_ceo" type="object"
                            groups="odex25_account_saip.group_executive_director_finance"/>

                    <button string="Approve" name="action_president" states="vice_president" type="object"
                            class="oe_highlight"
                            groups="odex25_account_saip.group_vice_president_resources"/>
                    <button string="Reset to Draft" name="action_budget_draft" states="vice_president" type="object"
                            groups="odex25_account_saip.group_vice_president_resources"/>
                    <button string="Refuse" name="action_budget_refused" states="vice_president" type="object"
                            groups="odex25_account_saip.group_vice_president_resources"/>

                    <button string="Approve" name="action_budget_confirmed" states="president" type="object"
                            class="oe_highlight"
                            groups="odex25_account_saip.group_chief_executive_officer"/>
                    <button string="Reset to Draft" name="action_budget_draft" states="president" type="object"
                            groups="odex25_account_saip.group_chief_executive_officer"/>
                    <button string="Refuse" name="action_budget_refused" states="president" type="object"
                            groups="odex25_account_saip.group_chief_executive_officer"/>

                    <field name="state" widget="statusbar"
                           statusbar_visible="draft,budget_manager,finance_ceo,vice_president,president,confirmed,refused"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="name" string="Sequence" readonly="1"/>
                            <field name="type" readonly="1"/>
                            <field name="transfer_type"
                                   attrs="{'readonly':[('state','!=','draft')],'required':[('type','=','transfer')]}"/>

                        </group>
                        <group>
                            <field name="date" required="1"
                                   attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="purpose" required="1"
                                   attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="budget_id" required="1" domain="[('state','=','done')]"
                                   attrs="{'readonly':[('state','!=','draft')]}"
                                   options="{'no_create': True, 'no_create_edit':True,'no_open': True}"/>
                            <field name="general_budget_id"
                                   attrs="{'readonly':[('state','!=','draft')],'invisible':[('transfer_type','=','between_position')],'required':[('transfer_type','=','same_position')]}"
                                   options="{'no_create': True, 'no_create_edit':True,'no_open': True}"/>
                        </group>
                    </group>
                    <notebook>
                        <page string="Details">
                            <field name="line_ids" attrs="{'readonly':[('state','!=','draft')]}">
                                <tree editable="buttom">
                                    <field name="budget_line_id" required="1"
                                           options="{'no_create': True, 'no_create_edit':True,'no_open': True}"/>
                                    <field name="general_budget_id" readonly="1"/>
                                    <field name="planned_amount" readonly="1" sum="Planned"/>
                                    <field name="after_modification" readonly="1" sum="Modification"/>
                                    <field name="available_liquidity" readonly="1" sum="Liquidity"/>
                                    <field name="transfer_debit" required="1" sum="TDebit"/>
                                    <field name="transfer_credit" required="1" sum="TCredit"/>
                                    <field name="percentage" widget="percentage"
                                           attrs="{'column_invisible': [('parent.state', '=','confirmed')]}"/>
                                    <field name="percentage_after_confirm" widget="percentage"
                                           attrs="{'column_invisible': [('parent.state', '!=','confirmed')]}"/>
                                </tree>
                                <form editable="0">
                                    <group>
                                        <group>
                                            <field name="budget_line_id"/>
                                            <field name="general_budget_id"/>
                                            <field name="planned_amount"/>
                                            <field name="after_modification"/>
                                        </group>
                                        <group col="2">
                                            <field name="available_liquidity"/>
                                            <field name="transfer_debit"/>
                                            <field name="transfer_credit"/>
                                            <field name="state" invisible="1"/>
                                            <field name="percentage" widget="percentage"
                                                   attrs="{'invisible': [('state', '=','confirmed')]}"/>
                                            <field name="percentage_after_confirm" widget="percentage"
                                                   attrs="{'invisible': [('state', '!=','confirmed')]}"/>
                                        </group>
                                    </group>
                                </form>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" groups="base.group_user"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>


    <record id="view_budget_operations_tree" model="ir.ui.view">
        <field name="name">budget.operations.tree</field>
        <field name="model">budget.operations</field>
        <field name="arch" type="xml">
            <tree string="Budget Operations">
                <field name="name"/>
                <field name="transfer_type"/>
                <field name="budget_id"/>
                <field name="date"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <record id="view_budget_transfer_operations_search" model="ir.ui.view">
        <field name="name">budget.operations.transfer.search</field>
        <field name="model">budget.operations</field>
        <field name="arch" type="xml">
            <search string="Budget Operations">
                <field name="name" filter_domain="[('name','ilike',self)]" string="name"/>
                <field name="state" filter_domain="[('state','ilike',self)]" string="State"/>
                <field name="budget_id"/>
                <field name="general_budget_id"/>
                <field name="date"/>
                <field name="transfer_type"/>
                <separator/>
                <filter name="state" string="State" context="{'group_by': 'state'}"/>
                <filter name="budget_id" string="Budget" context="{'group_by': 'budget_id'}"/>
                <filter name="transfer_type" string="Transfer Type" context="{'group_by': 'transfer_type'}"/>
                <filter name="general_budget_id" string="General Budget" context="{'group_by': 'general_budget_id'}"/>

            </search>
        </field>
    </record>

    <record id="account_budget_custom.open_budget_operations" model="ir.actions.act_window">
        <field name="domain">[('between_position','=',False),('budget_support','=',False)]</field>
    </record>

    <record id="budget_operations_action" model="ir.actions.act_window">
        <field name="name">Transfer Operations</field>
        <field name="res_model">budget.operations</field>
        <field name="view_mode">tree,form</field>
        <field name="view_ids" eval="[(5, 0, 0),
      (0, 0, {'view_mode': 'tree','view_id':ref('view_budget_operations_tree')}),
      (0, 0, {'view_mode': 'form', 'view_id': ref('view_budget_operations_form')})]"/>
        <field name="search_view_id" ref="view_budget_transfer_operations_search"/>
        <field name="context">{'default_between_position':True,'default_type':'transfer'}</field>
        <field name="domain">[('between_position','=',True)]</field>
    </record>


    <!--    Budget Support Operation-->

    <record id="support_budget_operations_form_view" model="ir.ui.view">
        <field name="name">budget.operations.support.form</field>
        <field name="model">budget.operations</field>
        <field name="arch" type="xml">
            <form string="Budget Operations">
                <header>
                    <button string="Send" name="action_budget_manager" states="draft" type="object" class="oe_highlight"
                            groups="account_budget_custom.group_department_manager_budget,account_budget_custom.group_budget_user"/>

                    <button string="Approve" name="action_finance_ceo" states="budget_manager" type="object"
                            class="oe_highlight"
                            groups="account_budget_custom.group_department_manager_budget"/>
                    <button string="Reset to Draft" name="action_budget_draft" states="budget_manager" type="object"
                            groups="account_budget_custom.group_department_manager_budget"/>
                    <button string="Refuse" name="action_budget_refused" states="budget_manager" type="object"
                            groups="account_budget_custom.group_department_manager_budget"/>

                    <button string="Approve" name="action_vice_president" states="finance_ceo" type="object"
                            class="oe_highlight"
                            groups="odex25_account_saip.group_executive_director_finance"/>
                    <button string="Reset to Draft" name="action_budget_draft" states="finance_ceo" type="object"
                            groups="odex25_account_saip.group_executive_director_finance"/>
                    <button string="Refuse" name="action_budget_refused" states="finance_ceo" type="object"
                            groups="odex25_account_saip.group_executive_director_finance"/>
                    <field name="state" widget="statusbar"
                           statusbar_visible="draft,budget_manager,finance_ceo,confirmed,refused"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="name" string="Sequence" readonly="1"/>
                            <field name="type" readonly="1"/>
                        </group>
                        <group>
                            <field name="date" required="1"
                                   attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="amount" required="1"
                                 attrs="{'readonly':[('state','!=','draft')]}"/>
                        </group>
                    </group>
                    <group>
                        <group>
                            <field name="budget_id" domain="[('state','=','done')]" required="1"
                                    attrs="{'readonly':[('state','!=','draft')]}"
                                   options="{'no_create': True, 'no_create_edit':True,'no_open': True}"/>
                            <field name="general_budget_id" required="1"
                                   attrs="{'readonly':[('state','!=','draft')]}"
                                   options="{'no_create': True, 'no_create_edit':True,'no_open': True}"/>
                            <field name="from_budget_line_id" required="1" string="Budget Item"
                                   attrs="{'readonly':[('state','!=','draft')]}"
                                   options="{'no_create': True, 'no_create_edit':True,'no_open': True}"/>

                        </group>
                    </group>

                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids" groups="base.group_user"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>

    <record id="budget_support_operations_tree_view" model="ir.ui.view">
        <field name="name">budget.operations.support.tree</field>
        <field name="model">budget.operations</field>
        <field name="arch" type="xml">
            <tree string="Budget Operations">
                <field name="name"/>
                <field name="budget_id"/>
                <field name="general_budget_id"/>
                <field name="from_budget_line_id"/>
                <field name="date"/>
                <field name="amount" sum="Amount"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <record id="view_budget_support_operations_search" model="ir.ui.view">
        <field name="name">budget.operations.support.search</field>
        <field name="model">budget.operations</field>
        <field name="arch" type="xml">
            <search string="Budget Operations">
                <field name="name" filter_domain="[('name','ilike',self)]" string="name"/>
                <field name="state" filter_domain="[('state','ilike',self)]" string="State"/>
                <field name="date"/>
                <field name="budget_id"/>
                <field name="general_budget_id"/>
                <field name="from_budget_line_id"/>
                <separator/>
                <filter name="state" string="State" context="{'group_by': 'state'}"/>
                <filter name="date" string="Date" context="{'group_by': 'date'}"/>
                <filter name="budget_id" string="Budget" context="{'group_by': 'budget_id'}"/>
                <filter name="from_budget_line_id" string="Budget Item" context="{'group_by': 'from_budget_line_id'}"/>
                <filter name="general_budget_id" string="General Budget" context="{'group_by': 'general_budget_id'}"/>

            </search>
        </field>
    </record>

    <record id="budget_support_operations_action" model="ir.actions.act_window">
        <field name="name">Budget Support Operations</field>
        <field name="res_model">budget.operations</field>
        <field name="view_mode">tree,form</field>
        <field name="view_ids" eval="[(5, 0, 0),
      (0, 0, {'view_mode': 'tree','view_id':ref('budget_support_operations_tree_view')}),
      (0, 0, {'view_mode': 'form', 'view_id': ref('support_budget_operations_form_view')})]"/>
        <field name="search_view_id" ref="view_budget_support_operations_search"/>
        <field name="context">{'default_budget_support':True,'default_type':'support'}</field>
        <field name="domain">[('budget_support','=',True)]</field>

    </record>
    <!--<Trnasfer Betwwen Budgets>-->

    <record id="view_budget_operations_transfer_budget_form" model="ir.ui.view">
        <field name="name">budget.operations.transfer.budget.form</field>
        <field name="model">budget.operations</field>
        <field name="arch" type="xml">
            <form string="Budget Operations">
                <header>
                    <button string="Approve" name="transfer_available_liquidity" states="draft" type="object"
                            class="oe_highlight"
                            groups="account_budget_custom.group_department_manager_budget"/>
                    <button string="Reset to Draft" name="action_budget_draft" type="object" states="refused"
                            groups="account_budget_custom.group_department_manager_budget"/>

                    <field name="state" widget="statusbar"
                           statusbar_visible="draft,confirmed,refused"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="name" string="Sequence" readonly="1"/>
                            <field name="type" readonly="1"/>
                        </group>
                        <group>
                            <field name="date" required="1" attrs="{'readonly':[('state','!=','draft')]}"/>
                            <field name="transfer_from_budget_id" required="1"  attrs="{'readonly':[('state','!=','draft')]}"
                                   options="{'no_create': True, 'no_create_edit':True,'no_open': True}"/>

                            <field name="transfer_to_budget_id" required="1" attrs="{'readonly':[('state','!=','draft')]}"
                                   options="{'no_create': True, 'no_create_edit':True,'no_open': True}"/>

                        </group>
                    </group>
                    <notebook>
                        <page string="Details">
                            <field name="line_ids" attrs="{'readonly':[('state','!=','draft')]}">
                                <tree editable="buttom">
                                    <field name="budget_line_from_id" required="1"
                                           options="{'no_create': True, 'no_create_edit':True,'no_open': True}"/>
                                    <field name="available" readonly="1" sum="Liquidity"
                                           attrs="{'column_invisible': [('parent.state', '=','confirmed')]}"/>
                                    <field name="transferd_balance" string="Available Liquidity" readonly="1"
                                           sum="Liquidity"
                                           attrs="{'column_invisible': [('parent.state', '!=','confirmed')]}"/>

                                </tree>
                                <form editable="0">
                                    <group>
                                        <group>
                                            <field name="budget_line_from_id"/>
                                        </group>
                                        <group col="2">
                                             <field name="state" invisible="1"/>
                                            <field name="available"
                                                   attrs="{'invisible': [('state', '=','confirmed')]}"/>
                                            <field name="transferd_balance" string="Available Liquidity"
                                                   attrs="{'invisible': [('state', '!=','confirmed')]}"/>
                                        </group>
                                    </group>
                                </form>
                            </field>
                        </page>
                    </notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
        </field>
    </record>


    <record id="view_budget_operations_transfer_tree" model="ir.ui.view">
        <field name="name">budget.operations.tree</field>
        <field name="model">budget.operations</field>
        <field name="arch" type="xml">
            <tree string="Budget Operations">
                <field name="name"/>
                <field name="transfer_type"/>
                <field name="budget_id"/>
                <field name="date"/>
                <field name="state"/>
            </tree>
        </field>
    </record>

    <record id="view_operations_transfer_search" model="ir.ui.view">
        <field name="name">budget.operations.budget.transfer.search</field>
        <field name="model">budget.operations</field>
        <field name="arch" type="xml">
            <search string="Budget Operations">
                <field name="name" filter_domain="[('name','ilike',self)]" string="name"/>
                <field name="state" filter_domain="[('state','ilike',self)]" string="State"/>
                <field name="transfer_from_budget_id"/>
                <field name="transfer_to_budget_id"/>
                <field name="date"/>
                <separator/>
                <filter name="state" string="State" context="{'group_by': 'state'}"/>
                <filter name="transfer_to_budget_id" string="Budget To"
                        context="{'group_by': 'transfer_to_budget_id'}"/>
                <filter name="transfer_from_budget_id" string="Budget From"
                        context="{'group_by': 'transfer_from_budget_id'}"/>
            </search>
        </field>
    </record>

    <record id="account_budget_custom.open_budget_operations" model="ir.actions.act_window">
        <field name="domain">[('between_position','=',False),('budget_support','=',False)]</field>
    </record>

    <record id="budget_operations_transfer_action" model="ir.actions.act_window">
        <field name="name">Transfer Budgets Balance</field>
        <field name="res_model">budget.operations</field>
        <field name="view_mode">tree,form</field>
        <field name="view_ids" eval="[(5, 0, 0),
      (0, 0, {'view_mode': 'tree','view_id':ref('view_budget_operations_transfer_tree')}),
      (0, 0, {'view_mode': 'form', 'view_id': ref('view_budget_operations_transfer_budget_form')})]"/>
        <field name="search_view_id" ref="view_operations_transfer_search"/>
        <field name="context">{'default_type':'transfer_budget'}</field>
        <field name="domain">[('type','=','transfer_budget')]</field>
    </record>


</odoo>