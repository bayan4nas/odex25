<?xml version="1.0" encoding="utf-8"?>
<!--##########################################################-->
<!--###
Disclaimer                         ###-->
<!--##########################################################-->
<!--###
Lately, I started to get very busy after I         ###-->
<!--###
started my new position and I couldn't keep up     ###-->
<!--###
with clients demands & requests for customizations ###-->
<!--###
& upgrades, so I decided to publish this module    ###-->
<!--###
for community free of charge. Building on that,    ###-->
<!--###
I expect respect from whoever gets his/her hands   ###-->
<!--###
on my code, not to copy nor rebrand the module &   ###-->
<!--###
sell it under their names.                         ###-->
<!--##########################################################-->

<odoo>
    <data>

        <!--
            Workflow
        -->
        <record id="view_form_odoo_workflow" model="ir.ui.view">
            <field name="name">workflow.mobile.form</field>
            <field name="model">workflow.mobile</field>
            <field name="arch" type="xml">
                <form>
                    <header>
                        <button name="btn_load_nodes"
                            string="Load state Button"
                            type="object"
                            attrs="{'invisible':[('view_id','=',False)]}"
                            class="oe_highlight" />
                    </header>
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="btn_nodes" type="object" class="oe_stat_button"
                                icon="fa-codepen">
                                <span>Nodes</span>
                            </button>
                            <button name="btn_buttons" type="object" class="oe_stat_button"
                                icon="fa-flickr">
                                <span>Buttons</span>
                            </button>
                            <button name="toggle_active" type="object"
                                class="oe_stat_button" icon="fa-archive">
                                <field name="active" widget="boolean_button"
                                    options='{"terminology": "active"}' />
                            </button>
                        </div>
                        <div class="alert alert-danger oe_edit_only" role="alert">
                            <strong>Note:</strong> Workflow engine can only alter normal models like
                            crm.*, sale.*, hr.*, etc... (not transient like wizards nor abstract
                            like reports) also resource (res.*) &amp; interface (ir.*) models are
                            excluded from workflow engine. </div>
                        <group>
                            <group>
                                <field name="name" required="1" />
                                <field name="model_id" required="1" />
                                <field name="view_id" required="1" />
                                <field name="mobile_id" groups="base.group_no_one" required="1"/>
                                <field name="model_state_default" invisible="1" />
                            </group>
                        </group>
                        <notebook>
                            <page string="Nodes">

                                <field name="node_ids"
                                    context="{'default_workflow_id':id, 'active_test': False}">
                                    <tree decoration-muted="(not pre_active)">
                                        <field name="sequence_in_hdr" widget="handle" />
                                        <field name="name" />
                                        <field name="is_visible" />
                                        <field name="flow_start" />
                                        <field name="flow_end" />
                                        <field name="code_node" />
                                        <button name="toggle_pre_active" type="object"
                                            class="oe_stat_button" icon="fa-archive">
                                            <field name="pre_active" widget="boolean_button"
                                                options='{"terminology": "active"}' />
                                        </button>
                                    </tree>
                                </field>
                            </page>

                            <page string="BTN Nodes">
                                <field name="btn_ids">
                                    <tree string="">
                                        <field name="name"></field>
                                        <field name="string"></field>
                                        <field name="node_id"></field>
                                    </tree>
                                </field>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>

        <record id="view_tree_odoo_workflow" model="ir.ui.view">
            <field name="name">workflow.mobile.tree</field>
            <field name="model">workflow.mobile</field>
            <field name="arch" type="xml">
                <tree decoration-muted="(not active)">
                    <field name="name" />
                    <field name="model_id" />
                    <field name="view_id" />
                    <field name="active" widget="boolean_toggle" />
                </tree>
            </field>
        </record>

        <record id="view_search_odoo_workflow" model="ir.ui.view">
            <field name="name">workflow.mobile.search</field>
            <field name="model">workflow.mobile</field>
            <field name="arch" type="xml">
                <search string="Workflow">
                    <field name="name" string="Workflow" />
                    <field name="model_id" string="Model" />
                    <field name="active" />
                    <filter name="active" string="Active" domain="[('active','=',True)]"
                        help="Show active workflows" />
                    <filter name="inactive" string="Inactive" domain="[('active','=',False)]"
                        help="Show inactive workflows" />
                </search>
            </field>
        </record>

        <record id="action_odoo_workflow" model="ir.actions.act_window">
            <field name="name">Workflow</field>
            <field name="res_model">workflow.mobile</field>
            <!-- <field name="view_type">form</field> -->
            <field name="view_mode">tree,form</field>
            <field name="context">{'active_test': False, 'search_default_active': 1}</field>
        </record>

        <menuitem id="menu_odoo_workflow"
            action="action_odoo_workflow"
            parent="menu_odoo_workflow_mobile_root"
            name="Workflow"
            sequence="10" />

        <!--
            Workflow Nodes
        -->
        <record id="view_form_odoo_workflow_node" model="ir.ui.view">
            <field name="name">workflow.mobile.node.form</field>
            <field name="model">workflow.mobile.node</field>
            <field name="arch" type="xml">
                <form create="0">
                    <sheet>
                        <div class="oe_button_box" name="button_box">
                            <button name="toggle_pre_active" type="object"
                                class="oe_stat_button" icon="fa-archive">
                                <field name="pre_active" widget="boolean_button" />
                            </button>
                        </div>
                        <field name="workflow_id" invisible="1" />
                        <field name="model_id" invisible="1" />
                        <field name="model" invisible="1" />
                        <group>
                            <group>
                                <field name="name"
                                    placeholder="ex. 'Draft' or 'Direct Manager'"
                                    required="1" />
                                <field name="node_name"
                                    placeholder="ex. 'draft' or 'direct_manager'"
                                    required="1" />
                            </group>
                            <group>
                                <field name="sequence_in_hdr" required="1" />
                                <field name="is_visible" />
                                <field name="view_ids" widget="many2many_tags"
                                    attrs="{'invisible':[('is_visible','=',False)], 'required':[('is_visible','=',True)]}"
                                    domain="[('type','=','form'),('model','=',model)]" />
                            </group>
                            <group>
                                <field name="flow_start" />
                                <field name="flow_end" />
                            </group>
                            <group>
                                <field name="code_node" readonly="1" />
                            </group>
                        </group>
                        <notebook>
                            <page string="Buttons">
                                <field name="button_ids"
                                    context="{'default_node_id':id}">
                                    <tree>
                                        <field name="sequence" widget="handle" />
                                        <field name="name" />
                                        <field name="action_type" />
                                        <field name="is_highlight" />
                                        <field name="node_id" />
                                    </tree>
                                </field>
                            </page>


                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>


        <!--
            Workflow Node Buttons
        -->
        <record id="view_form_workflow_mobile_btn_wizard" model="ir.ui.view">
            <field name="name">workflow.mobile.node.button.form</field>
            <field name="model">workflow.mobile.node.button</field>
            <field name="arch" type="xml">
                <form create="0">
                    <field name="workflow_id" invisible="1" />
                    <field name="model" invisible="1" />
                    <field name="node_id" invisible="1"
                        domain="[('workflow_id','=',workflow_id)]" />
                    <sheet>
                        <group>
                            <group>
                                <field name="sequence" required="1" />
                                <field name="string" required="1" />
                                <field name="name" required="1" />
                                <field name="view_id"
                                    domain="[('type','=','form'),('model','=',model)]" />
                                <field name="btn_key" />
                                <field name="node_id" />
                                <field name="send_manager" />
                                <field name="is_refuse" />
                            </group>
                            <group>
                                <field name="is_highlight" />
                                <field name="has_icon" />
                                <field name="model_id" />
                                <field name="workflow_id" />
                                <field name="group_ids" widget="many2many_tags" />
                            </group>
                        </group>
                        <notebook>
                            <page string="Actions">
                                <group>
                                    <field name="action_type" required="1" />
                                </group>
                                <group name="code"
                                    attrs="{'invisible':[('action_type','!=','code')]}">
                                    <field name="code" widget="ace" options="{'mode': 'python'}"
                                        attrs="{'required':[('action_type','=','code')]}" />
                                </group>
                                <group name="action"
                                    attrs="{'invisible':[('action_type','!=','action')]}">
                                    <field name="server_action_id"
                                        
                                        context="{'default_is_workflow':True}"
                                        attrs="{'required':[('action_type','=','action')]}" />
                                </group>
                                <group name="win_action"
                                    attrs="{'invisible':[('action_type','!=','win_act')]}">
                                    <field name="win_act_id"
                                        attrs="{'required':[('action_type','=','win_act')]}" />
                                </group>
                            </page>
                            <page string="attrs">
                                <group name="readonly_attrs">
                                    <field name="readonly_attrs" widget="ace"
                                        options="{'mode': 'python'}" />
                                </group>
                                <group name="invisible_attrs">
                                    <field name="invisible_attrs" widget="ace"
                                        options="{'mode': 'python'}" />
                                </group>
                            </page>
                        </notebook>
                    </sheet>
                </form>
            </field>
        </record>
        <record id="view_tree_workflow_mobile_btn_wizard" model="ir.ui.view">
            <field name="name">workflow.mobile.node.button.tree</field>
            <field name="model">workflow.mobile.node.button</field>
            <field name="arch" type="xml">
                <tree create="0">
                    <field name="sequence" widget="handle" />
                    <field name="name" />
                    <field name="string" required="1" />
                    <field name="action_type" />
                    <field name="node_id" />
                    <field name="group_ids" widget="many2many_tags" />
                    <field name="model_id" />
                    <field name="view_id" />
                    <field name="workflow_id" />
                </tree>
            </field>
        </record>
        <record id="view_tree_a_odoo_workflow_node" model="ir.ui.view">
            <field name="name">workflow.mobile.node.tree</field>
            <field name="model">workflow.mobile.node</field>
            <field name="arch" type="xml">
                <tree create="0">
                    <field name="sequence_in_hdr" widget="handle" />
                    <field name="name" />
                    <field name="node_name" required="1" />
                    <field name="button_ids" />
                    <field name="button_ids" widget="many2many_tags" />
                    <field name="view_ids" widget="many2many_tags" />
                    <field name="workflow_id" />
                    <field name="active" />
                </tree>
            </field>
        </record>
        <record id="action_odoo_workflow_btn" model="ir.actions.act_window">
            <field name="name">BTN</field>
            <field name="res_model">workflow.mobile.node.button</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'group_by':['workflow_id','node_id']}</field>
        </record>
        <record id="action_odoo_workflow_node" model="ir.actions.act_window">
            <field name="name">node state</field>
            <field name="res_model">workflow.mobile.node</field>
            <field name="view_mode">tree,form</field>
            <field name="context">{'group_by':['workflow_id']}</field>
        </record>


        <menuitem id="menu_odoo_workflow_btn"
            name="Workflow BTN"
            action="action_odoo_workflow_btn"
            parent="menu_odoo_workflow_mobile_root"
            groups="group_manager"
            sequence="200" />

        <menuitem id="menu_odoo_workflow_node"
            name="Workflow node (state)"
            action="action_odoo_workflow_node"
            parent="menu_odoo_workflow_mobile_root"
            groups="group_manager"
            sequence="200" />
    </data>
</odoo>